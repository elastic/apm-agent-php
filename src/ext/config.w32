ARG_ENABLE('elasticapm', 'elasticapm support', 'no');

if (PHP_ELASTICAPM != 'no') {
	AC_DEFINE('HAVE_ELASTICAPM', 1, 'elasticapm support enabled');

	if (CHECK_LIB("libcurl_a.lib", "elasticapm", PHP_ELASTICAPM)
	    && CHECK_LIB("zlib_a.lib", "elasticapm", PHP_ELASTICAPM)
	    && CHECK_LIB("libssh2_debug.lib", "elasticapm", PHP_ELASTICAPM)
	    && CHECK_LIB("nghttp2_debug.lib", "elasticapm", PHP_ELASTICAPM)
	    && CHECK_LIB("libcrypto.lib", "elasticapm", PHP_ELASTICAPM)
	    && CHECK_LIB("libssl.lib", "elasticapm", PHP_ELASTICAPM)
	    && CHECK_LIB("wldap32.lib", "elasticapm", PHP_ELASTICAPM)
	    && CHECK_LIB("normaliz.lib", "elasticapm", PHP_ELASTICAPM)
    ) {
        ELASTICAPM_PHP_EXT_SOURCES =
            "ConfigManager.c" + " " +
            "elasticapm.c" + " " +
            "elasticapm_API.c" + " " +
            "elasticapm_assert.c" + " " +
            "internal_checks.c" + " " +
            "lifecycle.c" + " " +
            "log.c" + " " +
            "MemoryTracker.c" + " " +
            "php_error.c" + " " +
            "platform.c" + " " +
            "supportability.c" + " " +
            "SystemMetrics.c" + " " +
            "time_util.c" + " " +
            "Tracer.c" + " " +
            "util.c" + " " +
            "util_for_php.c" + " " +
            "";

        EXTENSION('elasticapm', ELASTICAPM_PHP_EXT_SOURCES, null, '/DZEND_ENABLE_STATIC_TSRMLS_CACHE=1');

        AC_DEFINE('HAVE_CURL', 1, 'Have cURL library');
        ADD_FLAG("CFLAGS_CURL", "/D CURL_STATICLIB");

	} else {
		WARNING("elasticapm cannot be built - required libraries not found");
	}    
}
